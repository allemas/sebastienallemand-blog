<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>JDK 22 - What’s up doctor ? | ERR404 Blog</title>
<meta name="keywords" content="">
<meta name="description" content="I actually discovered what&rsquo;s new in JDK22 and how Java became more attractive day by day. I&rsquo;d like to share a compilation of what I have discovered and tried with my short conclusion and point of view.
Before you start, you can find the release note here: https://jdk.java.net/22/release-notes
JEP 456: Unnamed Variables &amp; Patterns Sometimes you need to declare variables without using it, for matching patterns or for specific contexts. With JEP 456, you can now use _ instead of declaring the variable.">
<meta name="author" content="">
<link rel="canonical" href="http://localhost:1313/posts/jdk-22/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css" integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z&#43;V9&#43;cO1A=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/jdk-22/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="ERR404 Blog (Alt + H)">ERR404 Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      JDK 22 - What’s up doctor ?
    </h1>
    <div class="post-meta"><span title='2024-03-28 12:10:40 +0100 CET'>March 28, 2024</span>

</div>
  </header> 
  <div class="post-content"><p>I actually discovered what&rsquo;s new in JDK22 and how Java became more attractive day by day.
I&rsquo;d like to share a compilation of what I have discovered and tried with my short conclusion and point of view.</p>
<p>Before you start, you can find the release note here: <a href="https://jdk.java.net/22/release-notes">https://jdk.java.net/22/release-notes</a></p>
<h3 id="jep-456-unnamed-variables--patterns">JEP 456: Unnamed Variables &amp; Patterns<a hidden class="anchor" aria-hidden="true" href="#jep-456-unnamed-variables--patterns">#</a></h3>
<p>Sometimes you need to declare variables without using it, for matching patterns or for specific contexts.
With JEP 456, you can now use <code>_</code> instead of declaring the variable.
This works for pattern too, and allows you to ignore the type and the name of the registration component  in pattern matching.</p>
<h4 id="unnamed-variables">Unnamed Variables<a hidden class="anchor" aria-hidden="true" href="#unnamed-variables">#</a></h4>
<p>A very simple example about how you can now skip the variable declaration. Here you count the number of orders in an (bad ? :D) iterable order.
Singular <code>order</code>, is never used (and IDE will trigger a warning) you can simplify by replacing <code>order</code> by <code>_</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">count</span>(Iterable<span style="color:#f92672">&lt;</span>Order<span style="color:#f92672">&gt;</span> orders) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> total <span style="color:#f92672">=</span> 0;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (Order order : orders)    <span style="color:#75715e">// order is never unused</span>
</span></span><span style="display:flex;"><span>        total<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> total;
</span></span></code></pre></div><p>Becomes</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">count</span>(Iterable<span style="color:#f92672">&lt;</span>Order<span style="color:#f92672">&gt;</span> orders) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> total <span style="color:#f92672">=</span> 0;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (Order _ : orders)  <span style="color:#75715e">// order =&gt; _</span>
</span></span><span style="display:flex;"><span>        total<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> total;
</span></span></code></pre></div><p>I already know, I&rsquo;m going abuse it in <code>try/catch</code> clauses:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">try</span> { ... }
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">catch</span> (Exception _) { ... }
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">catch</span> (Throwable _) { ... }
</span></span></code></pre></div><h4 id="unnamed-patterns">Unnamed Patterns<a hidden class="anchor" aria-hidden="true" href="#unnamed-patterns">#</a></h4>
<p>For me, unnamed pattern will empower the Pattern Matching syntax <a href="https//openjdk.org/jeps/441"><code>JEP 441 Pattern Matching for switch</code></a> delivered in JDK21
Now you can use unnamed patterns and you can transition from this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Ball</span> permits RedBall, BlueBall, GreenBall { }
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">final</span>  <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RedBall</span>   <span style="color:#66d9ef">extends</span> Ball { }
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">final</span>  <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BlueBall</span>  <span style="color:#66d9ef">extends</span> Ball { }
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">final</span>  <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">GreenBall</span> <span style="color:#66d9ef">extends</span> Ball { }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Ball ball <span style="color:#f92672">=</span> <span style="color:#75715e">//...</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">switch</span> (ball) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> RedBall   red   <span style="color:#f92672">-&gt;</span> process(ball); <span style="color:#75715e">//&lt;- red var is unused</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> BlueBall  blue  <span style="color:#f92672">-&gt;</span> process(ball); <span style="color:#75715e">//&lt;- blue var is unused</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> GreenBall green <span style="color:#f92672">-&gt;</span> stopProcessing(); <span style="color:#75715e">// &lt;- green var is unused</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>RedBall</code> and <code>BlueBall</code> call the same function with balls as parameters and  <code>red</code> <code>blue</code> and <code>green</code> are all unused.
So you can inline <code>RedBall</code> and <code>BlueBall</code> in the same branch and replace <code>red</code> <code>blue</code> and <code>green</code>.</p>
<p>Now suppose that we define a record class Box which can hold any type of Ball, but might also hold the null value:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span> <span style="color:#66d9ef">switch</span> (box) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">case</span> Box(RedBall _), Box(BlueBall _) <span style="color:#f92672">-&gt;</span> processBox(box);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">case</span> Box(GreenBall _)                <span style="color:#f92672">-&gt;</span> stopProcessing();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">case</span> Box(<span style="color:#66d9ef">var</span> _)                      <span style="color:#f92672">-&gt;</span> pickAnotherBox();
</span></span><span style="display:flex;"><span>        }
</span></span></code></pre></div><p>Note: you added a switch branch for all other <code>Box</code> with <code>var _</code> that will catch all other patterns.</p>
<p>You can add <a href="https://openjdk.org/jeps/441#Case-refinement">Guard</a> pattern. Remember this guard covers the whole label branch and not only one pattern.
you can do:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">case</span> Box(RedBall _), Box(BlueBall _) when x <span style="color:#f92672">==</span> 42 <span style="color:#f92672">-&gt;</span> processBox(b);
</span></span></code></pre></div><p>and not</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">case</span> Box(RedBall _) when x <span style="color:#f92672">==</span> 0, Box(BlueBall _) when x <span style="color:#f92672">==</span> 42 <span style="color:#f92672">-&gt;</span> processBox(b);
</span></span></code></pre></div><p>Less common case you will be able to match patterns for <code>instanceof</code>, here an example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (r <span style="color:#66d9ef">instanceof</span> <span style="color:#a6e22e">ColoredPoint</span>(Point(<span style="color:#66d9ef">int</span> x, <span style="color:#66d9ef">int</span> y), Color c)) {
</span></span><span style="display:flex;"><span>    ... x ... y ... 
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Color is not used here, you can rename it with _:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (r <span style="color:#66d9ef">instanceof</span> <span style="color:#a6e22e">ColoredPoint</span>(Point(<span style="color:#66d9ef">int</span> x, <span style="color:#66d9ef">int</span> y), _)) { ... x ... y ... }
</span></span></code></pre></div><h3 id="jep-447-statements-before-super---its-a-feature-preview-">JEP 447: Statements before super(&hellip;) - IT&rsquo;S A FEATURE PREVIEW !<a hidden class="anchor" aria-hidden="true" href="#jep-447-statements-before-super---its-a-feature-preview-">#</a></h3>
<p>The main goal is to give developers greater freedom to express behaviors of constructors by adding logic while maintaining
the guarantee that constructors run in top-down order during the class instantiation, *<em>ensuring the code in the subclass constructor cannot interfere with the superclass instancation.</em></p>
<p>you can now prevent unnecessary work in the <code>super()</code> statement before validating an argument. By this you are now able to check or prepare arguments before calling the superclass constructor.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">PositiveBigInteger</span> <span style="color:#66d9ef">extends</span> BigInteger {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">PositiveBigInteger</span>(<span style="color:#66d9ef">long</span> value) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">super</span>(value);  <span style="color:#75715e">//  &lt;------------- Potentially unnecessary work</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (value <span style="color:#f92672">&lt;=</span> 0)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> IllegalArgumentException(<span style="color:#e6db74">&#34;non-positive value&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// BECOMES</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">PositiveBigInteger</span> <span style="color:#66d9ef">extends</span> BigInteger {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">PositiveBigInteger</span>(<span style="color:#66d9ef">long</span> value) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">super</span>(verifyPositive(value));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">long</span> <span style="color:#a6e22e">verifyPositive</span>(<span style="color:#66d9ef">long</span> value) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (value <span style="color:#f92672">&lt;=</span> 0)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> IllegalArgumentException(<span style="color:#e6db74">&#34;non-positive value&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> value;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Preparing the super class constructor arg</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Sub</span> <span style="color:#66d9ef">extends</span> Super {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">Sub</span>(Certificate certificate) {    <span style="color:#75715e">// Certificate type  </span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">super</span>(prepareByteArray(certificate)); <span style="color:#75715e">// super accept only byte[] </span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Auxiliary method transform Certificate to byte array</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> <span style="color:#a6e22e">prepareByteArray</span>(Certificate certificate) {  
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> publicKey <span style="color:#f92672">=</span> certificate.<span style="color:#a6e22e">getPublicKey</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (publicKey <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> IllegalArgumentException(<span style="color:#e6db74">&#34;null certificate&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">switch</span> (publicKey) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">case</span> RSAKey rsaKey <span style="color:#f92672">-&gt;</span> ...
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">case</span> DSAPublicKey dsaKey <span style="color:#f92672">-&gt;</span> ...
</span></span><span style="display:flex;"><span>            ...
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">default</span> <span style="color:#f92672">-&gt;</span> ...
</span></span><span style="display:flex;"><span>        };
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="jep-457-class-file-api-feature-preview-">JEP 457: Class-File API FEATURE PREVIEW !<a hidden class="anchor" aria-hidden="true" href="#jep-457-class-file-api-feature-preview-">#</a></h2>
<p>The objective here is providing a standard API for parsing, generating and transforming java class files.
By this API, developers can now: Parse, Generate and transform a classfile</p>
<h2 id="jep-458-launch-multi-file-source-code-programs">JEP 458: Launch Multi-File Source-Code Programs<a hidden class="anchor" aria-hidden="true" href="#jep-458-launch-multi-file-source-code-programs">#</a></h2>
<p>Java app launchers now are able to run programs based on multiple files of java source code. By this the transition for large projects will be more smooth.</p>
<h2 id="jep-459-string-templates-second-preview----feature-preview-">JEP 459: String Templates (Second Preview)  - FEATURE PREVIEW !<a hidden class="anchor" aria-hidden="true" href="#jep-459-string-templates-second-preview----feature-preview-">#</a></h2>
<p>Actually developers routinely compose String with concatenation (+), StringBuilder, String::format or MessageFormat. All of these are hard to read or verbose too much.
Template expressions are a new kind of expression in Java and can perform string interpolation but helps the developers compose strings safely and efficiently.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>String name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Joan&#34;</span>;
</span></span><span style="display:flex;"><span>String info <span style="color:#f92672">=</span> STR.<span style="color:#e6db74">&#34;My name is \{name}&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">assert</span> info.<span style="color:#a6e22e">equals</span>(<span style="color:#e6db74">&#34;My name is Joan&#34;</span>);   <span style="color:#75715e">// true</span>
</span></span></code></pre></div><p>String template comes with arithmetics expressions</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> x <span style="color:#f92672">=</span> 10, y <span style="color:#f92672">=</span> 20;
</span></span><span style="display:flex;"><span>String s <span style="color:#f92672">=</span> STR.<span style="color:#e6db74">&#34;\{x} + \{y} = \{x + y}&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> <span style="color:#e6db74">&#34;10 + 20 = 30&#34;</span>
</span></span></code></pre></div><p>Call methods and access fields</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>String s <span style="color:#f92672">=</span> STR.<span style="color:#e6db74">&#34;You have a \{getOfferType()} waiting for you!&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> <span style="color:#e6db74">&#34;You have a gift waiting for you!&#34;</span>
</span></span><span style="display:flex;"><span>String t <span style="color:#f92672">=</span> STR.<span style="color:#e6db74">&#34;Access at \{req.date} \{req.time} from \{req.ipAddress}&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> <span style="color:#e6db74">&#34;Access at 2022-03-25 15:34 from 8.8.8.8&#34;</span>
</span></span></code></pre></div><p><strong>To avoid refactoring, double quote characters can now be USED INSIDE the expressions without being escaped</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>String msg <span style="color:#f92672">=</span> STR.<span style="color:#e6db74">&#34;The file \{filePath} \{file.exists() ? &#34;</span>does<span style="color:#e6db74">&#34;: &#34;</span>does not<span style="color:#e6db74">&#34;} exist&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> <span style="color:#e6db74">&#34;The file tmp.dat does exist&#34;</span> or <span style="color:#e6db74">&#34;The file tmp.dat does not exist&#34;</span>
</span></span></code></pre></div><p>Multiline is supported in the source file without introducing newlines ! The value of the embedded expression is interpolated <code>int</code> the result at the position of the <code>\ </code>
The template is considered to continue on the same line.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>String time <span style="color:#f92672">=</span> STR.<span style="color:#e6db74">&#34;The time is \{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    // The java.time.format package is very useful
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    DateTimeFormatter
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      .ofPattern(&#34;</span>HH:mm:ss<span style="color:#e6db74">&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      .format(LocalTime.now())
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">} right now&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> <span style="color:#e6db74">&#34;The time is 12:34:56 right now&#34;</span>
</span></span></code></pre></div><h4 id="fmt-processor">FMT Processor<a hidden class="anchor" aria-hidden="true" href="#fmt-processor">#</a></h4>
<p>FMT is another template processor, it also interpret the format specified in the left of the embedded expressions.</p>
<p><strong>The format specifiers are the same as those defined in java.util.Formatter</strong> <a href="https://www.logicbig.com/tutorials/core-java-tutorial/java-se-api/util-formatter.html">Documentation</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">record</span> <span style="color:#a6e22e">Rectangle</span>(String name, <span style="color:#66d9ef">double</span> width, <span style="color:#66d9ef">double</span> height) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> <span style="color:#a6e22e">area</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> width <span style="color:#f92672">*</span> height;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>Rectangle<span style="color:#f92672">[]</span> zone <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Rectangle<span style="color:#f92672">[]</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">new</span> Rectangle(<span style="color:#e6db74">&#34;Alfa&#34;</span>, 17.<span style="color:#a6e22e">8</span>, 31.<span style="color:#a6e22e">4</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">new</span> Rectangle(<span style="color:#e6db74">&#34;Bravo&#34;</span>, 9.<span style="color:#a6e22e">6</span>, 12.<span style="color:#a6e22e">4</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">new</span> Rectangle(<span style="color:#e6db74">&#34;Charlie&#34;</span>, 7.<span style="color:#a6e22e">1</span>, 11.<span style="color:#a6e22e">23</span>),
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>String table <span style="color:#f92672">=</span> FMT.<span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Description     Width    Height     Area
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    %-12s\{zone[0].name}  %7.2f\{zone[0].width}  %7.2f\{zone[0].height}     %7.2f\{zone[0].area()}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    %-12s\{zone[1].name}  %7.2f\{zone[1].width}  %7.2f\{zone[1].height}     %7.2f\{zone[1].area()}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    %-12s\{zone[2].name}  %7.2f\{zone[2].width}  %7.2f\{zone[2].height}     %7.2f\{zone[2].area()}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    \{&#34; &#34;.repeat(28)} Total %7.2f\{zone[0].area() + zone[1].area() + zone[2].area()}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">| Description     Width    Height     Area
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">| Alfa            17.80    31.40      558.92
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">| Bravo            9.60    12.40      119.04
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">| Charlie          7.10    11.23       79.73
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|                              Total  757.69
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">| &#34;&#34;&#34;</span>
</span></span></code></pre></div><h4 id="user-defined-processors">User defined processors<a hidden class="anchor" aria-hidden="true" href="#user-defined-processors">#</a></h4>
<p>Developers can easily create template processors for use in template expression.</p>
<p>That is useful shorthand, but again it is more accurate to say that a template processor is an object which is an
instance of the functional interface StringTemplate.Processor.</p>
<p>In particular, the object&rsquo;s class implements the single abstract method of that interface, process, which takes a
StringTemplate and returns an object. A static field such as STR merely stores an instance of such a class.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> x <span style="color:#f92672">=</span> 10, y <span style="color:#f92672">=</span> 20;
</span></span><span style="display:flex;"><span>StringTemplate st <span style="color:#f92672">=</span> RAW.<span style="color:#e6db74">&#34;\{x} plus \{y} equals \{x + y}&#34;</span>;
</span></span><span style="display:flex;"><span>String s <span style="color:#f92672">=</span> st.<span style="color:#a6e22e">toString</span>();
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> StringTemplate{ fragments <span style="color:#f92672">=</span> <span style="color:#f92672">[</span> <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#e6db74">&#34; plus &#34;</span>, <span style="color:#e6db74">&#34; equals &#34;</span>, <span style="color:#e6db74">&#34;&#34;</span> <span style="color:#f92672">]</span>, values <span style="color:#f92672">=</span> <span style="color:#f92672">[</span>10, 20, 30<span style="color:#f92672">]</span> }
</span></span></code></pre></div><p>A template processor that implements the StringTemplate.Processor interface directly can be fully general.</p>
<p>The declaration of the StringTemplate.Processor interface is:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> java.lang;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">StringTemplate</span> {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@FunctionalInterface</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">Processor</span><span style="color:#f92672">&lt;</span>R, E <span style="color:#66d9ef">extends</span> Throwable<span style="color:#f92672">&gt;</span> {
</span></span><span style="display:flex;"><span>        R <span style="color:#a6e22e">process</span>(StringTemplate st) <span style="color:#66d9ef">throws</span> E;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>It can return objects of any type, not just String. It can also throw checked exceptions if processing fails, either because the template is invalid or for some other reason, such as an I/O error. If a template processor throws checked exceptions then developers who use it in template expressions must handle processing failures with try-catch statements, or else propagate the exceptions to callers.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> JSON <span style="color:#f92672">=</span> StringTemplate.<span style="color:#a6e22e">Processor</span>.<span style="color:#a6e22e">of</span>(
</span></span><span style="display:flex;"><span>        (StringTemplate st) <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">new</span> JSONObject(st.<span style="color:#a6e22e">interpolate</span>())
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>String name    <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Joan Smith&#34;</span>;
</span></span><span style="display:flex;"><span>String phone   <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;555-123-4567&#34;</span>;
</span></span><span style="display:flex;"><span>String address <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;1 Maple Drive, Anytown&#34;</span>;
</span></span><span style="display:flex;"><span>JSONObject doc <span style="color:#f92672">=</span> JSON.<span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;name&#34;:    &#34;\{name}&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;phone&#34;:   &#34;\{phone}&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;address&#34;: &#34;\{address}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    };
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>;
</span></span></code></pre></div><h4 id="safely-composing-and-executing-database-queries">Safely composing and executing database queries<a hidden class="anchor" aria-hidden="true" href="#safely-composing-and-executing-database-queries">#</a></h4>
<p>The template processor class below, QueryBuilder, first creates a SQL query string from a string template. It then creates a JDBC PreparedStatement from that query string and sets its parameters to the values of the embedded expressions.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">record</span> <span style="color:#a6e22e">QueryBuilder</span>(Connection conn)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">implements</span> StringTemplate.<span style="color:#a6e22e">Processor</span><span style="color:#f92672">&lt;</span>PreparedStatement, SQLException<span style="color:#f92672">&gt;</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> PreparedStatement <span style="color:#a6e22e">process</span>(StringTemplate st) <span style="color:#66d9ef">throws</span> SQLException {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 1. Replace StringTemplate placeholders with PreparedStatement placeholders</span>
</span></span><span style="display:flex;"><span>        String query <span style="color:#f92672">=</span> String.<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#34;?&#34;</span>, st.<span style="color:#a6e22e">fragments</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 2. Create the PreparedStatement on the connection</span>
</span></span><span style="display:flex;"><span>        PreparedStatement ps <span style="color:#f92672">=</span> conn.<span style="color:#a6e22e">prepareStatement</span>(query);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 3. Set parameters of the PreparedStatement</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> index <span style="color:#f92672">=</span> 1;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (Object value : st.<span style="color:#a6e22e">values</span>()) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">switch</span> (value) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">case</span> Integer i <span style="color:#f92672">-&gt;</span> ps.<span style="color:#a6e22e">setInt</span>(index<span style="color:#f92672">++</span>, i);
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">case</span> Float f   <span style="color:#f92672">-&gt;</span> ps.<span style="color:#a6e22e">setFloat</span>(index<span style="color:#f92672">++</span>, f);
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">case</span> Double d  <span style="color:#f92672">-&gt;</span> ps.<span style="color:#a6e22e">setDouble</span>(index<span style="color:#f92672">++</span>, d);
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">case</span> Boolean b <span style="color:#f92672">-&gt;</span> ps.<span style="color:#a6e22e">setBoolean</span>(index<span style="color:#f92672">++</span>, b);
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">default</span>        <span style="color:#f92672">-&gt;</span> ps.<span style="color:#a6e22e">setString</span>(index<span style="color:#f92672">++</span>, String.<span style="color:#a6e22e">valueOf</span>(value));
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> ps;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    PreparedStatement ps <span style="color:#f92672">=</span> DB.<span style="color:#e6db74">&#34;SELECT * FROM Person p WHERE p.last_name = \{name}&#34;</span>;
</span></span><span style="display:flex;"><span>        ResultSet rs <span style="color:#f92672">=</span> ps.<span style="color:#a6e22e">executeQuery</span>();
</span></span></code></pre></div><h2 id="jep-461-stream-gatherers-preview">JEP 461: Stream Gatherers (Preview)<a hidden class="anchor" aria-hidden="true" href="#jep-461-stream-gatherers-preview">#</a></h2>
<p>Stream API now has custom intermediate operations. This will allow stream pipelines to transform data.</p>
<h3 id="you-introduce-the-flowing-built-in-in-the-javautilstreamgatherers-class">you introduce the flowing built-in in the java.util.stream.Gatherers class:<a hidden class="anchor" aria-hidden="true" href="#you-introduce-the-flowing-built-in-in-the-javautilstreamgatherers-class">#</a></h3>
<ul>
<li>fold is a stateful many-to-one gatherer which constructs an aggregate incrementally and emits that aggregate when no more input elements exist.</li>
<li>mapConcurrent is a stateful one-to-one gatherer which invokes a supplied function for each input element concurrently, up to a supplied limit.</li>
<li>scan is a stateful one-to-one gatherer which applies a supplied function to the current state and the current element to produce the next element, which it passes downstream.</li>
<li>windowFixed is a stateful many-to-many gatherer which groups input elements into lists of a supplied size, emitting the windows downstream when they are full.</li>
<li>windowSliding is a stateful many-to-many gatherer which groups input elements into lists of a supplied size. After the first window, each subsequent window is created from a copy of its predecessor by dropping the first element and appending the next element from the input stream..</li>
</ul>
<h3 id="parallel-evaluation">Parallel evaluation<a hidden class="anchor" aria-hidden="true" href="#parallel-evaluation">#</a></h3>
<p>Parallel evaluation of a gatherer is split into two distinct modes. When a combiner is not provided, the stream library can still extract parallelism by executing upstream and downstream operations in parallel, analogous to a short-circuitable parallel().forEachOrdered() operation. When a combiner is provided, parallel evaluation is analogous to a short-circuitable parallel().reduce() operation.</p>
<h3 id="composing-gatherers">Composing gatherers<a hidden class="anchor" aria-hidden="true" href="#composing-gatherers">#</a></h3>
<p>Gatherers support composition via the andThen(Gatherer) method, which joins two gatherers where the first produces elements that the second can consume. This enables the creation of sophisticated gatherers by composing simpler ones, just like function composition. Semantically,</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>source.<span style="color:#a6e22e">gather</span>(a).<span style="color:#a6e22e">gather</span>(b).<span style="color:#a6e22e">gather</span>(c).<span style="color:#a6e22e">collect</span>(...)
</span></span><span style="display:flex;"><span>is equivalent to
</span></span><span style="display:flex;"><span>source.<span style="color:#a6e22e">gather</span>(a.<span style="color:#a6e22e">andThen</span>(b).<span style="color:#a6e22e">andThen</span>(c)).<span style="color:#a6e22e">collect</span>(...)
</span></span></code></pre></div><h2 id="jep-462-structured-concurrency-second-preview">JEP 462: Structured Concurrency (Second Preview)<a hidden class="anchor" aria-hidden="true" href="#jep-462-structured-concurrency-second-preview">#</a></h2>
<p>The main objective is to simplify concurrent programming by introducing an API to structure it. By this you will be able to manage sets of subtasks running on different threads with a better observability.</p>
<p>If you look the shared example in the JEP here:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Response <span style="color:#a6e22e">handle</span>() <span style="color:#66d9ef">throws</span> ExecutionException, InterruptedException {
</span></span><span style="display:flex;"><span>    Future<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span>  user  <span style="color:#f92672">=</span> esvc.<span style="color:#a6e22e">submit</span>(() <span style="color:#f92672">-&gt;</span> findUser());
</span></span><span style="display:flex;"><span>    Future<span style="color:#f92672">&lt;</span>Integer<span style="color:#f92672">&gt;</span> order <span style="color:#f92672">=</span> esvc.<span style="color:#a6e22e">submit</span>(() <span style="color:#f92672">-&gt;</span> fetchOrder());
</span></span><span style="display:flex;"><span>    String theUser  <span style="color:#f92672">=</span> user.<span style="color:#a6e22e">get</span>();   <span style="color:#75715e">// Join findUser</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span>    theOrder <span style="color:#f92672">=</span> order.<span style="color:#a6e22e">get</span>();  <span style="color:#75715e">// Join fetchOrder</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> Response(theUser, theOrder);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>you have two concurrent tasks, each can fail and you need to wait until both have finished before returning.
The developer should manually coordinate the lifetime of these two subtasks and recover if anything goes wrong.</p>
<p>If Virtual thread allows spawning a ton of thread. Structured concurrency proposes to coordinate them and enable observability tools.
With the Structured Concurrency API building a maintainable, reliable and observable code(for a youb server for example) will be easier.</p>
<p>With these tools, you can refactor the previous example like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Response <span style="color:#a6e22e">handle</span>() <span style="color:#66d9ef">throws</span> ExecutionException, InterruptedException {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span> (<span style="color:#66d9ef">var</span> scope <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> StructuredTaskScope.<span style="color:#a6e22e">ShutdownOnFailure</span>()) {
</span></span><span style="display:flex;"><span>        Supplier<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span>  user  <span style="color:#f92672">=</span> scope.<span style="color:#a6e22e">fork</span>(() <span style="color:#f92672">-&gt;</span> findUser());
</span></span><span style="display:flex;"><span>        Supplier<span style="color:#f92672">&lt;</span>Integer<span style="color:#f92672">&gt;</span> order <span style="color:#f92672">=</span> scope.<span style="color:#a6e22e">fork</span>(() <span style="color:#f92672">-&gt;</span> fetchOrder());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        scope.<span style="color:#a6e22e">join</span>()            <span style="color:#75715e">// Join both subtasks</span>
</span></span><span style="display:flex;"><span>             .<span style="color:#a6e22e">throwIfFailed</span>();  <span style="color:#75715e">// ... and propagate errors</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Here, both subtasks have succeeded, so compose their results</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> Response(user.<span style="color:#a6e22e">get</span>(), order.<span style="color:#a6e22e">get</span>());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>you find here a new StructuredTaskScope here, in a try/catch block, findUser and fetchOrder are forked in the StructuredTaskScope,
As in the first example, these tasks are executed in parallel but here you can use the API to call join methods and throw an exception if something goes wrong.</p>
<p>ErrorHandling, Cancelation, clarity and observability are guarantees by the StructuredTaskScope class API.
If an exception occurs the API will propagate the error and cancel the other thread.</p>
<p>StructuredTaskScope don&rsquo;t come alone, principally:</p>
<ul>
<li>StructuredTaskScope creates a new (virtual) thread for each subtask. A subtask can create its own nested StructuredTaskScope to fork its own subtasks, thus creating a hierarchy.</li>
<li>Shutdown policies deal with concurrent subtasks. It is common to use short-circuiting patterns to avoid doing unnecessary work.</li>
<li>Processing results: allow to manage composite results and permit processing subtasks results.</li>
</ul>
<p>I&rsquo;ll let you discover the rest with Fan-in scenarios and Custom shutdown policies <a href="https://openjdk.org/jeps/462#Custom-shutdown-policies">here</a></p>
<p>This is the first time I summarize the JDK release, hope you enjoy it and you discover new things.
If I made a mistake let me know and contact me, nobody is perfect.
See you next release :)</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="http://localhost:1313/">ERR404 Blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
